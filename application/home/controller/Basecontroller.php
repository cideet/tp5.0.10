<?php
/**
 * Created by PhpStorm.
 * User: sf
 * Date: 2017/10/21
 * Time: 17:18
 */

namespace app\home\controller;

class Basecontroller extends \app\common\controller\Commoncontroller
{
    public $memberUname;
    public $top20News;
    public $top20Comments;
    public $nav;

    public function _initialize()
    {
        parent::_initialize(); // TODO: Change the autogenerated stub
        if (session('memberUserSession', '', 'memberUserSession')) {
            $this->memberUname = json_decode(session('memberUserSession', '', 'memberUserSession'))->username;
        } else {
            $this->memberUname = '';
            //$this->error('请先登录', '/index.php/index/login/index');
        }
        $top20News = model('News')->field('id,title')->limit(20)->select();
        $top20Comments = model('NewsComment')->limit(20)->select();
        foreach ($top20Comments as $k => $v) {
            $v['article_title'] = model('News')->getNewsById($top20Comments[$k]['news_id'])['title'];
            $v['member_name'] = model('Member')->getMembernameById($top20Comments[$k]['member_id']);
            $v['head_img'] = model('Member')->getMemberHeadImgById($top20Comments[$k]['member_id']);
        }
        $nav = model('Category')->getNormalFirstCategory();
        //echo(json_encode($nav));
        //base文件，切忌瞎JS输出
        $this->assign('topNews', $top20News);
        $this->assign('topComments', $top20Comments);
        $this->assign('memberUsername', $this->memberUname);
        $this->assign('nav', $nav);
    }
}
