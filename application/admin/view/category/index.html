<{include file="public/header" /}>

<body class="vdouw-main-body">
<div class="vdouw-admin-position">
    <i class="icon-home mr-3"></i><span>后台首页111</span>
    <cite class="ml-3 mr-3">></cite>
    <span>文章分类管理</span>
</div>
<div class="mt-10 mb-10 vdouw-admin-title">
    <b class="font20 height-100">文章分类列表</b>
    <i class="ml-10 mr-10">|</i>
    <a class="c-pointer color-admin-blue" href="/index.php/Admin/Cate/add" target="right_content">添加文章分类</a>
</div>
<table class="width100 vdouw-table" cellpadding="0" cellspacing="0">
    <thead>
    <tr>
        <td class="width10">ID</td>
        <td class="width10">排序</td>
        <td class="width20">菜单名</td>
        <td class="width20">新增时间</td>
        <td class="width20">操作</td>
    </tr>
    </thead>
    <tbody>
    <form id="vdouw-form">
        <{volist name="categorys" id="v"}>
        <tr>
            <td><{$v["id"]}></td>
            <td><input type="text" size="5" name="listorder[<{$v.id}>]" value="<{$v.listorder}>"
                       class="form-control"/></td>
            <td><{$v["name"]}></td>
            <td><{$v["update_time"]}></td>
            <td>
                    <span class="c-pointer color-admin-blue vdouw-addson" title="添加子菜单"
                          data-id="<{$v['id']}>">添加子菜单</span>
                <i class="ml-5 mr-5">|</i>
                <span class="c-pointer color-admin-blue vdouw-edit" title="修改" data-id="<{$v['id']}>">修改</span>
                <i class="ml-5 mr-5">|</i>
                <span class="c-pointer color-admin-blue vdouw-delete" title="删除" data-id="<{$v['id']}>">删除</span>
            </td>
        </tr>
        <{/volist}>
    </form>

    <tr>
        <td></td>
        <td colspan="5"><input type="button" id="vdouw-listorder" class="btn btn-primary color-white" value="更新排序"/>
        </td>
    </tr>
    </tbody>
</table>

<script>
    var SCOPE = {
        "save_url": "/index.php/Admin/Cate/add",
        "edit_url": "/index.php/Admin/Cate/edit",
        'set_status_url': '/index.php/Admin/Cate/setStatus',
        'listorder_url': '/index.php/Admin/Cate/listOrder'
    }

    //添加子栏目
    $(".vdouw-addson").click(function () {
        var url = SCOPE.save_url + "/id/" + $(this).attr("data-id");
        location.href = url;
    });

    //编辑
    $(".vdouw-edit").click(function () {
        var url = SCOPE.edit_url + '/id/' + $(this).attr('data-id');
        console.log(url);
        location.href = url;
    });

    //删除
    $('.vdouw-delete').on('click', function () {
        $data = {};
        $data['cid'] = $(this).attr('data-id');
        $data['is_delete'] = "1";
        console.log($data);
        layer.open({
            type: 0,
            title: '删除确认框',
            btn: ['确定', '取消'],
            icon: 3,
            closeBtn: 2,
            content: "您确定要删除吗？",
            scrollbar: true,
            yes: function () {
                $.post(SCOPE.set_status_url, $data, function (s) {
                    if (s.status == 1) {
                        return dialog.success(s.message, '');
                    } else {
                        return dialog.error(s.message);
                    }
                }, "JSON");
            }
        });
    });

    /* 排序操作 */
    $('#vdouw-listorder').click(function () {
        var data = $("#vdouw-form").serializeArray();       // 获取 listorder内容
        postData = {};
        $(data).each(function (i) {
            postData[this.name] = this.value;
        });
        var url = SCOPE.listorder_url;
        $.post(url, postData, function (result) {
            if (result.status == 1) {
                return dialog.success(result.message, result['data']['jump_url']);
            } else if (result.status == 0) {
                return dialog.error(result.message, result['data']['jump_url']);
            }
        }, "JSON");
    });
</script>


</body>
</html>